# 说明文档

## 项目规划
- 项目名称：DouK-Downloader（抖音/TikTok 下载器）
- 运行环境：`Windows 11`（TRAE 开发环境）
- 目标：提供稳定的下载与接口访问能力，支持 CLI/TUI/Web 等模式。
- 版本：当前启动显示 `DouK-Downloader V5.8 Beta`。

## 实施方案
- 采用顺序化思考拆解问题并执行闭环（ToDoList 管理）。
- 优先修复启动阻塞的语法错误；运行验证；记录结果；不影响既有功能与结构。
- 修复点以最小改动为原则，保持代码风格一致。

## 进度记录
- 2025-11-06 修复启动报错（多处 f-string 语法问题）并验证启动：
  - 修复 `src/config/parameter.py` 中 TikTok `ttwid` 拼接的跨行 f-string（改为单行）。
  - 修复 `src/custom/internal.py` 中 `PROJECT_NAME` 的跨行 f-string（改为单行）。
  - 修复 `src/interface/template.py` 中 `X-Bogus` 参数拼接的跨行 f-string（改为单行）。
  - 修复 `src/interface/info.py` 中嵌套 f-string 导致的未闭合问题（改为字符串拼接）。
  - 修复 `src/module/ffmpeg.py` 中 macOS 终端脚本的 f-string 反斜杠表达式（提取为变量）。
  - 修复 `src/module/ffmpeg.py` 中 `which(Path)` 类型问题（转换为 `str(path)`）。
  - 修复 `src/manager/recorder.py` 中跨行 f-string（改为单行）。
  - 运行验证：程序成功进入交互界面，提示 Cookie 未设置并允许模式选择，已正常退出。

- 2025-11-06 增强令牌校验：
  - 更新 `src/custom/function.py` 的 `is_valid_token(token)` 读取环境变量 `DOUK_TOKEN`。
  - 未设置 `DOUK_TOKEN` 时默认放行（返回 True），设置后需请求头 `token` 与其一致。
  - 使用方法（Windows PowerShell）：
    - 当前会话：`$env:DOUK_TOKEN = "your-secret-token"`
    - 永久设置：`setx DOUK_TOKEN "your-secret-token"`（重开终端生效）
  - 接口测试：调用 `GET /token` 并携带请求头 `token: your-secret-token`，返回“验证成功”。

备注：后续如需扩展功能或调整计划，需先更新本说明文档中的“项目规划/实施方案”，再执行开发，并在“进度记录”中标记完成与说明结果。